\name{experiment}
\title{Set up a simCity experiment}
\alias{simCity.experiment}
\alias{experiment}

\concept{ simCity model }
\description{
Set up  a simCity simulation experiment by passing  a \code{\link[simCity]{simc.model}}, repetitions, a vector of sample sizes, and two functions to process simulation results. It produces an object of class \code{simCity.experiment} which contains the basic info required by  a \code{\link[simCity]{run}} to run the actual simulation.  
}
\usage{

experiment<-(model,N=NULL,rep=1,fun.oneblock=.return.data,fun.aggregate=NULL) 


}
\arguments{
  \item{model}{ a \code{\link[simCity]{simc.model}} }
  \item{N}{ number of cases to generate in each run}
  \item{rep}{ number of repetition in each block}
  \item{fun.oneblock}{a custom function to process data generated by each repetition made by \code{\link[simCity]{run.block}}. It must accept a \code{\link{data.frame}} and a \code{\link{list}} as arguments (in this order). If NULL, applies internal function \code{.return.data} which return the data generated with additional variables indicating the replication number \code{rep}, the sample size (\code{N}, the coefficients \code{coefs} used to generated the data.}
  \item{fun.aggregate}{a custom function to process the output data.frame generated by \code{fun.oneblock}. It must accept a \code{\link{data.frame}} as its argument. This function is usefull to aggregate the results across experimental factors. }

}

\details{
With \code{experiment} one set up the simulation experiment argument. To be ready, the object should be filled with the equation coefficients using  a \code{\link[simCity]{coefs}}. When done, the experiment is run with \code{\link[simCity]{run}}.
}
\value{
  an object of class \code{simCity.experiment}.
}
\seealso{
  \code{\link[simCity]{simc.model}},  \code{\link[simCity]{make.data}}, \code{\link[simCity]{run.block}},\code{\link[simCity]{run}},\code{\link[simCity]{coefs}}
}
\examples{
### set up an experiment based on a simple model with two variables  normally distributed, compute the Pearson correlation and save some statistics, with 10 repetitions per sample, varying the N (from 20 to 100 by 20), and aggregating the results by N. 

getstats<-function(simdata,arguments) {
  n.case<-arguments$N
  rstat=cor.test(simdata$x,simdata$y)
  rho<-arguments$coefs[2]
  v<-c("ncase"=n.case,"rho"=rho,
       "r"=rstat$estimate,"rpvalue"=rstat$p.value,"sig"=(rstat$p.value<.05))
  as.data.frame(v)
}

myaggregate<-function(results) {
  aggregate(results,list(rho,mean)
}

s.model<-simc.model()
x~1,rnorm 0 1
y~x
#
myexp<-experiment(s.model,N=c(10,20,30),rep=10,getstats,myaggregate)

}
\keyword{models}
